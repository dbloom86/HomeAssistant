#================================
# Robo Miep
#================================ 

  #=====================
  # Input Booleans
  #=====================

input_boolean:

    #=====================
    # Kamers
    #=====================
  woonkamer:
    name: Woonkamer
    initial: off

  keuken:
    name: Keuken
    initial: off

  hal:
    name: Hal
    initial: off

  overloop:
    name: Overloop
    initial: off

  kamer_fynn:
    name: Kamer Fynn
    initial: off

  kamer_luca:
    name: Kamer Luca
    initial: off

  slaapkamer:
    name: Slaapkamer
    initial: off

  badkamer:
    name: Badkamer
    initial: off

  #=====================
  # Map
  #=====================

camera:
  - platform: xiaomi_cloud_map_extractor
    host: !secret xiaomi_vacuum_host
    token: !secret xiaomi_vacuum_token
    username: !secret xiaomi_cloud_username
    password: !secret xiaomi_cloud_password
    country: "de"
    name: "Robomiep Camera"
    draw: ['all']
    attributes:
      - calibration_points
      - charger
      - cleaned_rooms
      - country
      - goto
      - goto_path
      - goto_predicted_path
      - image
      - is_empty
      - map_name
      - no_go_areas
      - no_mopping_areas
      - obstacles
      - ignored_obstacles
      - obstacles_with_photo
      - ignored_obstacles_with_photo
      - path
      - room_numbers
      - rooms
      - vacuum_position
      - vacuum_room
      - vacuum_room_name
      - walls
      - zones
    colors:
      color_map_inside: [0, 0, 0, 0]
      color_map_outside: [0, 0, 0, 0]
      color_unknown: [0, 0, 0, 0]
      color_robo: [235, 235, 235]
      color_path: [255, 255, 255]
      color_charger: [201, 204, 173]
      color_room_names: [255, 255, 255]
      color_cleaned_area: [140, 140, 140]
    room_colors:
      16: [252, 186, 3]
      17: [10, 182, 194]
      18: [34, 150, 227]
      19: [191, 107, 88]
      20: [165, 114, 181]
    map_transformation:
      scale: 2
    sizes:
      charger_radius: 6.5
      vacuum_radius: 8
    scan_interval:
      seconds: 5
    auto_update: true
    


  #=====================
  # Automations
  #=====================
automation:

    #=====================
    # Stofzuig Keuken En Woonkamer
    #=====================
  - alias: "Vacuum kitchen and living"
    trigger:
    - platform: time
      at: '19:15:00'
    condition:
    - condition: not
      conditions:
      - condition: state
        entity_id: climate.toon_thermostat
        attribute: preset_modes
        state: eco
    action:
    - service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: [17,18]

  #=====================
  # Scripts
  #=====================
script:

    #=====================
    # Stofzuig Woonkamer
    #=====================
  vacuum_living:
    alias: "Vacuum Living"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: 18

    #=====================
    # Stofzuig Hal
    #=====================
  vacuum_hall:
    alias: "Vacuum Hall"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: 16 

    #=====================
    # Stofzuig Keuken
    #=====================
  vacuum_kitchen:
    alias: "Vacuum Kitchen"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: 17

    #=====================
    # Stofzuig Keuken en Woonkamer
    #=====================
  vacuum_kitchen_living:
    alias: "Vacuum Kitchen and Living"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: [17,18]

    #=====================
    # Stofzuig Overloop
    #=====================
  vacuum_overloop:
    alias: "Vacuum Overloop"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: 18

    #=====================
    # Stofzuig Kamer Fynn
    #=====================
  vacuum_fynn:
    alias: "Vacuum Kamer Fynn"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: 20 

    #=====================
    # Stofzuig Kamer Luca
    #=====================
  vacuum_luca:
    alias: "Vacuum Kamer Luca"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: 19

    #=====================
    # Stofzuig Kamer Sab en Dunc
    #=====================
  vacuum_sleep:
    alias: "Vacuum Kamer Sab en Dunc"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: 16

    #=====================
    # Stofzuig Badkamer
    #=====================
  vacuum_bathroom:
    alias: "Vacuum Badkamer"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: 17

    #=====================
    # Stofzuig Verdieping
    #=====================
  vacuum_floor1:
    alias: "Vacuum Verdieping"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: [16,18,19,20]

    #=====================
    # Stofzuig Overloop en kamer Luca
    #=====================
  vacuum_overloop_luca:
    alias: "Vacuum Overloop en Luca"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: [18,19]

    #=====================
    # Stofzuig Overloop en kamer Fynn
    #=====================
  vacuum_overloop_fynn:
    alias: "Vacuum Overloop en Fynn"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: [18,20]

    #=====================
    # Stofzuig Overloop en Slaapkamer
    #=====================
  vacuum_overloop_sleep:
    alias: "Vacuum Overloop en Slaapkamer"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: [18,16]

    #=====================
    # Stofzuig kamer Luca en Fynn
    #=====================
  vacuum_luca_fynn:
    alias: "Vacuum Luca en Fynn"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: [20,19]

    #=====================
    # Stofzuig kamer Luca en Slaapkamer
    #=====================
  vacuum_luca_sleep:
    alias: "Vacuum Luca en Slaapkamer"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: [16,19]

    #=====================
    # Stofzuig kamer Fynn en Slaapkamer
    #=====================
  vacuum_fynn_sleep:
    alias: "Vacuum Fynn en Slaapkamer"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: [16,20]

    #=====================
    # Stofzuig Slaapkamers
    #=====================
  vacuum_slaapkamers:
    alias: "Vacuum Slaapkamers"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: [16,19,20]

    #=====================
    # Stofzuig kinderkamers en overloop
    #=====================
  vacuum_kids_overloop:
    alias: "Vacuum Kinderkamers en Overloop"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: [18,19,20]

    #=====================
    # Stofzuig Luca, Slaapkamer en overloop
    #=====================
  vacuum_luca_sleep_overloop:
    alias: "Vacuum Luca, Slaapkamer en overloop"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: [18,19,16]

    #=====================
    # Stofzuig Fynn, Slaapkamer en overloop
    #=====================
  vacuum_fynn_sleep_overloop:
    alias: "Vacuum Fynn, Slaapkamer en overloop"
    sequence:
      service: xiaomi_miio.vacuum_clean_segment
      target:
        entity_id: vacuum.miep
      data:
        segments: [18,20,16]

    #=====================
    # Stofzuigen BG
    #=====================
  stofzuig_bg:
    alias: "Stofzuig Begane Grond"
    sequence:
    - service: vacuum.send_command
      target:
        device_id: 122a8a65b1a8e6870391ff4dd677c276
      data:
        command: load_multi_map
        params: 0
    - delay:
        seconds: 10
    - choose:
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.woonkamer.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.keuken.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.hal.state == off}}'
          sequence:
            - service: script.vacuum_kitchen_living
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.woonkamer.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.keuken.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.hal.state == off}}'
          sequence:
            - service: script.vacuum_living
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.woonkamer.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.keuken.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.hal.state == off}}'
          sequence:
            - service: script.vacuum_kitchen
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.hal.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.woonkamer.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.keuken.state == off}}'
          sequence: 
            - service: script.vacuum_hall
      default:
        - service: browser_mod.toast
          data:
            message: "Wat je wil kan niet. Probeer de schoon te maken ruimtes aan te passen."
    - service: homeassistant.turn_off
      entity_id: group.cleaning_rooms

    #=====================
    # Stofzuigen Verdieping
    #=====================
  stofzuig_v1:
    alias: "Stofzuig Verdieping"
    sequence:
    - service: vacuum.send_command
      target:
        device_id: 122a8a65b1a8e6870391ff4dd677c276
      data:
        command: load_multi_map
        params: 1
    - delay:
        seconds: 10
    - choose:
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.overloop.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_luca.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_fynn.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.slaapkamer.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.badkamer.state == off}}'
          sequence:
            - service: script.vacuum_floor1
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.overloop.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_luca.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_fynn.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.slaapkamer.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.badkamer.state == off}}'
          sequence:
            - service: script.vacuum_overloop
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.overloop.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_luca.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_fynn.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.slaapkamer.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.badkamer.state == off}}'
          sequence:
            - service: script.vacuum_luca
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.overloop.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_luca.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_fynn.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.slaapkamer.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.badkamer.state == off}}'
          sequence:
            - service: script.vacuum_fynn
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.overloop.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_luca.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_fynn.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.slaapkamer.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.badkamer.state == off}}'
          sequence:
            - service: script.vacuum_sleep
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.overloop.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_luca.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_fynn.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.slaapkamer.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.badkamer.state == on}}'
          sequence:
            - service: script.vacuum_bathroom
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.overloop.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_luca.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_fynn.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.slaapkamer.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.badkamer.state == off}}'
          sequence:
            - service: script.vacuum_overloop_luca
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.overloop.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_luca.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_fynn.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.slaapkamer.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.badkamer.state == off}}'
          sequence:
            - service: script.vacuum_overloop_fynn
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.overloop.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_luca.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_fynn.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.slaapkamer.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.badkamer.state == off}}'
          sequence:
            - service: script.vacuum_overloop_sleep
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.overloop.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_luca.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_fynn.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.slaapkamer.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.badkamer.state == off}}'
          sequence:
            - service: script.vacuum_luca_fynn
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.overloop.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_luca.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_fynn.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.slaapkamer.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.badkamer.state == off}}'
          sequence:
            - service: script.vacuum_luca_sleep
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.overloop.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_luca.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_fynn.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.slaapkamer.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.badkamer.state == off}}'
          sequence:
            - service: script.vacuum_fynn_sleep
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.overloop.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_luca.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_fynn.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.slaapkamer.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.badkamer.state == off}}'
          sequence:
            - service: script.vacuum_slaapkamers
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.overloop.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_luca.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_fynn.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.slaapkamer.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.badkamer.state == off}}'
          sequence:
            - service: script.vacuum_kids_overloop
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.overloop.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_luca.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_fynn.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.slaapkamer.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.badkamer.state == off}}'
          sequence:
            - service: script.vacuum_luca_sleep_overloop
        - conditions:
            - condition: template
              value_template: '{{states.input_boolean.overloop.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_luca.state == off}}'
            - condition: template
              value_template: '{{states.input_boolean.kamer_fynn.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.slaapkamer.state == on}}'
            - condition: template
              value_template: '{{states.input_boolean.badkamer.state == off}}'
          sequence:
            - service: script.vacuum_fynn_sleep_overloop
      default:
        - service: browser_mod.toast
          data:
            message: "Wat je wil kan niet. Probeer de schoon te maken ruimtes aan te passen."
    - service: homeassistant.turn_off
      entity_id: group.cleaning_rooms

    #=====================
    # Return to Dock
    #=====================
  miep_return_to_dock:
    alias: "Miep Return to Dock"
    sequence:
    - service: vacuum.send_command
      target:
        device_id: 122a8a65b1a8e6870391ff4dd677c276
      data:
        command: load_multi_map
        params: 0
    - delay:
        seconds: 10
    - service: vacuum.return_to_base
      target:
        device_id: 122a8a65b1a8e6870391ff4dd677c276